@model MeherEstateDevelopers.Models.CommercialTransferDetailData
@{ Layout = "~/Views/Shared/_StaffLayout.cshtml"; }
<div class="row gap-20 pos-r">
    <div class="col-md-7">
        <div class="bgc-white p-20 bd">
            <h6 class="c-grey-900">Transfer</h6>
            <div class="mT-30">
                <div class="col-md-12">
                    <div class="form-row">
                        <div class="form-group col-md-2">
                            <label>Unit No.</label>
                            @if (Model.Data.Project_Name == "SA Premium Homes")
                            {
                                <h5 id="shp-no">@Model.Data.ApplicationNo</h5>
                            }
                            else
                            {
                                <h5 id="shp-no">@Model.Data.shop_no</h5>
                            }
                            <input type="hidden" class="form-control" id="shp-id" value="@Model.Data.Id" name="shop_Id">
                        </div>
                        <div class="form-group col-md-2">
                            <label>Project</label>
                            <h5>@Model.Data.Project_Name</h5>
                        </div>
                        <div class="form-group col-md-2">
                            <label>Shop Size</label>
                            <h5 id="shp-size">@Model.Data.Total_SqFt_Marlas Sq Ft</h5>
                            <input type="hidden" class="form-control" value="@Model.Data.Total_SqFt_Marlas" id="sp-size" name="Shop_Size" readonly>
                        </div>
                        <div class="form-group col-md-2">
                            <label>Type</label>
                            <h5 id="shop-type">@Model.Data.Type</h5>
                        </div>
                        <div class="form-group col-md-2">
                            <label>Location</label>
                            <h5 id="shp-loc">@Model.Data.Location</h5>
                        </div>
                        <div class="form-group col-md-2">
                            <label>Floor</label>
                            <h5 id="shp-loc">@Model.Data.Floor</h5>
                        </div>

                        <div class="form-group col-md-2">
                            <label>Status</label>
                            <h5>@Model.Data.Status</h5>
                        </div>
                    </div>
                    <hr />
                    <div class="form-row">
                        <div class="form-group col-md-2">
                            <label>@Model.Data.Type Price</label>
                            <h5 id="shp-price">@string.Format("{0:0,0.##}",Model.Installments.Sum(x=> x.Amount))</h5>
                        </div>
                        <div class="form-group col-md-2" id="dis-amt-sec" style="display:none">
                            <label>Discount Amount</label>
                            <h5 id="dis-amt">@string.Format("{0:0,0.##}", Model.Discounts.Sum(x => x.Discount_Amount))</h5>
                        </div>
                        <div class="form-group col-md-2">
                            <label>Booking Date</label>
                            <h5 id="booking-date">@string.Format("{0:dd-MMM-yyyy}", Model.Installments.OrderBy(x => x.Due_Date).FirstOrDefault().Due_Date)</h5>
                        </div>
                        <div class="form-group col-md-2">
                            <label>Balance</label>
                            <h5 id="bal">@Model.Balance.Balance_Amount</h5>
                        </div>
                        <div class="form-group col-md-2">
                            <label>Received Amount</label>
                            <h5>@string.Format("{0:n0}", Model.Balance.Received_Amount)</h5>
                        </div>
                    </div>
                </div>
            </div>
            <hr />
            <div class="form-row">
                <div class="col-md-4">
                    <h6 class="c-grey-900">Personal Information</h6>
                </div>
            </div>
            @{ int counter = 1;}
            @foreach (var v in Model.Owners)
            {
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <div class="panel-heading">
                            <h5 class="panel-title">
                                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#@string.Concat("own",counter.ToString())" aria-expanded="true"></a>
                                Owner <span class="own-count-info">1</span>
                            </h5>
                        </div>
                    </div>

                    <div class="panel-collapse collapse in show" id="@string.Concat("own",counter.ToString())">
                        <div class="mT-30">
                            <div class="form-row">
                                <div class="form-group col-md-3">
                                    <label>Name</label>
                                    <input type="text" class="form-control" value="@v.Name" id="Name" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>Father's/Husband's Name</label>
                                    <input type="text" class="form-control" id="Father_Husband" value="@v.Father_Husband" readonly>
                                </div>
                                <div class="form-group col-md-5">
                                    <label>Postal Address</label>
                                    <input type="text" class="form-control" id="Postal_Address" value="@v.Postal_Address" readonly>
                                </div>
                                <div class="form-group col-md-5">
                                    <label>Residential Address</label>
                                    <input type="text" class="form-control" id="Residential_Address" value="@v.Residential_Address" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>City</label>
                                    <input type="text" class="form-control" id="City" value="@v.City" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>Date Of Birth</label>
                                    <input type="text" class="form-control" id="Date_Of_Birth" value="@v.Date_Of_Birth" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>CNIC / NICOP</label>
                                    <input type="text" class="form-control" id="CNIC_NICOP" value="@v.CNIC_NICOP" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>Occupation</label>
                                    <input type="text" class="form-control" id="Occupation" value="@v.Occupation" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>Nationality</label>
                                    <input type="text" class="form-control" id="Nationality" value="@v.Nationality" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>Email</label>
                                    <input type="text" class="form-control" id="Email" value="@v.Email" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>Phone Office</label>
                                    <input type="text" class="form-control" id="Phone_Office" value="@v.Phone_Office" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>Residential</label>
                                    <input type="text" class="form-control" id="Residential" value="@v.Residential" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>Mobile 1</label>
                                    <input type="text" class="form-control" id="Mobile_1" value="@v.Mobile_1" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>Mobile 2</label>
                                    <input type="text" class="form-control" id="Mobile_2" value="@v.Mobile_2" readonly>
                                </div>
                            </div>
                        </div>
                        <hr />
                        <h6 class="c-grey-900">Nominee</h6>
                        <div class="mT-30">
                            <div class="form-row">
                                <div class="form-group col-md-2">
                                    <label>Name</label>
                                    <input type="text" class="form-control" id="Nominee_Name" value="@v.Nominee_Name" readonly>
                                </div>
                                <div class="form-group col-md-2">
                                    <label>CNIC / NICOP</label>
                                    <input type="text" class="form-control" id="Nominee_CNIC_NICOP" value="@v.Nominee_CNIC_NICOP" readonly>
                                </div>
                                <div class="form-group col-md-2">
                                    <label>Relation</label>
                                    <input class="form-control" id="Nominee_Relation" value="@v.Nominee_Relation" readonly>
                                </div>
                                <div class="form-group col-md-5">
                                    <label>Address</label>
                                    <input type="text" class="form-control" id="Nominee_Address" value="@v.Nominee_Address" readonly>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                counter++;
            }
            <hr />
            <div class="mT-30">
                <div class="form-row">
                    <div class="col-md-6">
                        <table class="table table-striped table-bordered" cellspacing="0" width="100%" style="margin-bottom:0px">
                            <thead class="thead-dark">
                                <tr><th>Sr.</th></tr>
                            </thead>
                        </table>
                        <div style="min-height:0px; max-height:500px;overflow:auto" class=" ps--active-y">
                            <table class="table table-striped table-bordered" id="all-instments" cellspacing="0" width="100%">
                                <tbody>
                                    @{ foreach (var item in Model.Installments)
                                        {
                                            <tr>
                                                <td>@item.Installment_Name</td>
                                                <td>@string.Format("{0:n0}", item.Amount)</td>
                                                <td>@string.Format("{0:dd-MMM-yyyy}", item.Due_Date)</td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <table class="table table-striped table-bordered" cellspacing="0" width="100%" style="margin-bottom:0px">
                            <thead class="thead-dark">
                                <tr>
                                    <th>Receipt No.</th>
                                    <th>Amount</th>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th></th>
                                </tr>
                            </thead>
                        </table>
                        <div style="min-height:0px; max-height:500px;overflow:auto" class=" ps--active-y">
                            <table class="table table-striped table-bordered" id="rec-amts" cellspacing="0" width="100%">
                                <tbody>
                                    @{ int srcount = 1;
                                        foreach (var item in Model.Receipts)
                                        {
                                            <tr id="@item.Id">
                                                <td>@srcount</td>
                                                <td>@item.ReceiptNo</td>
                                                <td>@string.Format("{0:n0}", item.Amount)</td>
                                                <td>@string.Format("{0:dd-MMM-yyyy}", item.DateTime)</td>
                                                <td>@item.PaymentType</td>
                                            </tr>
                                            srcount++;
                                        }
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-5">
        <div class="bgc-white p-20 bd">
            <div class="mT-30">
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <h5 style="width:100%">NDC Serial No: @Model.TransferTo.Select(x => x.TransferRequestNo).FirstOrDefault()</h5>
                    </div>
                    @if (Model.TransferTo.Select(x => x.Plot_Price).FirstOrDefault() != null)
                    {
                        <div class="form-group col-md-6">
                            <h5 style="width:100%">Plot Price: @string.Format("{0:0,0.##}", Model.TransferTo.Select(x => x.Plot_Price).FirstOrDefault())</h5>
                        </div>
                    }

                </div>
                <div class="form-row row">
                    @if (Model.TransferTo.Any(x => x.Dealer_Req == true))
                    {
                        <div class="form-group col-md-6">
                            <h4 style="color:red">Dealer Transfer</h4>

                        </div>
                    }
                    @if (Model.TransferTo.Any(x => x.Employee_Req == true))
                    {
                        <div class="form-group col-md-6">
                            <h4 style="color:red">Employee Transfer</h4>
                        </div>
                    }
                    <div class="form-group col-md-6">
                        <h6 style="width: auto;float: left;margin: 7px;">Blood Relation Transfer</h6>
                        <label class="switch"><input type="checkbox" id="bl-rel"><span class="slider round"></span></label>
                    </div>
                    <div class="form-group col-md-6">
                        <h6 style="width: auto;float: left;margin: 7px;">Transfer Charges Wave off</h6>
                        <label class="switch"><input type="checkbox" id="tran-ch"><span class="slider round"></span></label>
                    </div>
                    <div class="form-group col-md-6">
                        <h6 style="width: auto;float: left;margin: 7px;">Other Transfer Charges</h6>
                        <label class="switch"><input type="checkbox" id="oth-tran-ch"><span class="slider round"></span></label>
                    </div>
                    <div class="form-group col-md-6 tran-amt" style="display:none">
                        <label>Other Amount</label>
                        <input class="form-control coma" placeholder="12,345" required>
                        <input type="hidden" id="amt" name="Amount" class="amt" required>
                    </div>
                    <input type="hidden" id="blod-rel" value="false" />
                    <input type="hidden" id="Trans-val" value="false" />
                    <input type="hidden" id="oth-Trans-val" value="false" />
                </div>
                <hr />
            </div>
            @{ int transCount = 1;}

            @foreach (var v in Model.TransferTo)
            {
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h5 class="panel-title">
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#@string.Concat("trans",transCount.ToString())" aria-expanded="true"></a>
                            New Owner <span class="own-count-info">@transCount</span>
                        </h5>
                    </div>

                    <div class="panel-collapse collapse in show" id="@string.Concat("trans",transCount.ToString())">
                        <div class="mT-30">
                            <div class="form-row">
                                <h5>
                                    Transfer To: &nbsp;&nbsp;
                                    @if (Model.TransferTo.Any(x => x.Status != 0))
                                    {
                                        <span>| &nbsp; &nbsp;</span><button class="btn btn-primary snd-to-fd-plt" data-trans="@Model.TransferTo.Select(x=>x.GroupTag).FirstOrDefault()">Send Back To Front Desk</button>
                                    }
                                    <span>| &nbsp; &nbsp;</span><button class="btn btn-primary bio-verif-buyer-plt" data-trans="@Model.TransferTo.Select(x=>x.GroupTag).FirstOrDefault()"><i class="fas fa-fingerprint"></i> Biometric Record</button>
                                </h5>
                                <input type="hidden" id="plt-id" value="@Model.Data.Id" name="File_Form_Id">
                            </div>
                            <div class="form-row">
                                @if (v.IsCompanyProperty == true)
                                {
                                    <div class="form-group col-md-12">
                                        <label>Comapny Name</label>
                                        <input type="text" class="form-control" value="@v.Name" id="Name" readonly>
                                    </div>
                                }
                                else
                                {
                                    <div class="form-group col-md-4">
                                        <label>Name</label>
                                        <input type="text" class="form-control" value="@v.Name" id="Name" readonly>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label>Father's/Husband's Name</label>
                                        <input type="text" class="form-control" id="Father_Husband" value="@v.Father_Husband" readonly>
                                    </div>
                                }
                                <div class="form-group col-md-10">
                                    <label>Postal Address</label>
                                    <input type="text" class="form-control" id="Postal_Address" value="@v.Postal_Address" readonly>
                                </div>
                                <div class="form-group col-md-10">
                                    <label>Residential Address</label>
                                    <input type="text" class="form-control" id="Residential_Address" value="@v.Residential_Address" readonly>
                                </div>
                                <div class="form-group col-md-4">
                                    <label>City</label>
                                    <input type="text" class="form-control" id="City" value="@v.City" readonly>
                                </div>
                                @if (v.IsCompanyProperty == true)
                                {
                                    <div class="form-group col-md-4">
                                        <label>Date Of Incorp.</label>
                                        <input type="text" class="form-control" id="Date_Of_Birth" value="@v.Date_Of_Birth" readonly>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label>NTN</label>
                                        <input type="text" class="form-control" id="CNIC_NICOP" value="@v.CNIC_NICOP" readonly>
                                    </div>
                                }
                                else
                                {
                                    <div class="form-group col-md-4">
                                        <label>Date Of Birth</label>
                                        <input type="text" class="form-control" id="Date_Of_Birth" value="@v.Date_Of_Birth" readonly>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label>CNIC / NICOP</label>
                                        <input type="text" class="form-control" id="CNIC_NICOP" value="@v.CNIC_NICOP" readonly>
                                    </div>
                                }
                                <div class="form-group col-md-4">
                                    <label>Occupation</label>
                                    <input type="text" class="form-control" id="Occupation" value="@v.Occupation" readonly>
                                </div>
                                <div class="form-group col-md-4">
                                    <label>Nationality</label>
                                    <input type="text" class="form-control" id="Nationality" value="@v.Nationality" readonly>
                                </div>
                                <div class="form-group col-md-4">
                                    <label>Email</label>
                                    <input type="text" class="form-control" id="Email" value="@v.Email" readonly>
                                </div>
                                <div class="form-group col-md-4">
                                    <label>Phone Office</label>
                                    <input type="text" class="form-control" id="Phone_Office" value="@v.Phone_Office" readonly>
                                </div>
                                <div class="form-group col-md-4">
                                    <label>Residential</label>
                                    <input type="text" class="form-control" id="Residential" value="@v.Residential" readonly>
                                </div>
                                <div class="form-group col-md-4">
                                    <label>Mobile 1</label>
                                    <input type="text" class="form-control" id="Mobile_1" value="@v.Mobile_1" readonly>
                                </div>
                                <div class="form-group col-md-4">
                                    <label>Mobile 2</label>
                                    <input type="text" class="form-control" id="Mobile_2" value="@v.Mobile_2" readonly>
                                </div>
                            </div>
                            <hr />
                            <h6 class="c-grey-900">Nominee</h6>
                            <div class="mT-40">
                                <div class="form-row">
                                    <div class="form-group col-md-4">
                                        <label>Name</label>
                                        <input type="text" class="form-control" id="Nominee_Name" value="@v.Nominee_Name" readonly>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label>CNIC / NICOP</label>
                                        <input type="text" class="form-control" id="Nominee_CNIC_NICOP" value="@v.Nominee_CNIC_NICOP" readonly>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label>Relation</label>
                                        <input class="form-control" id="Nominee_Relation" value="@v.Nominee_Relation" readonly>
                                    </div>
                                    <div class="form-group col-md-10">
                                        <label>Address</label>
                                        <input type="text" class="form-control" id="Nominee_Address" value="@v.Nominee_Address" readonly>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                transCount++;
            }

            @if (Model.TransferTo.Any(x => x.Transfer_Success != true))
            {
                <h3 style="text-align:center">Check List of NDC</h3>
                <hr style="border-top:13px solid red" />
                <div class="form-row" style="margin:15px">
                    <div class="col-md-6">
                        <div class="checkbox checkbox-circle checkbox-info peers ai-c">
                            @{
                                if (Model.TransferTo.Any(x => x.AllDocuments == true))
                                {
                                    <input type="checkbox" value="@Model.TransferTo.Select(x=>x.Id).FirstOrDefault()" id="all-doc" data-checklst="1" class="peer com-rec-plt-pres" checked>
                                }
                                else
                                {
                                    <input type="checkbox" value="@Model.TransferTo.Select(x=>x.Id).FirstOrDefault()" id="all-doc" data-checklst="1" class="peer com-rec-plt-pres">
                                }
                            }
                            <label class="peers peer-greed js-sb ai-c">
                                <span class="peer peer-greed ser-ch-nam" style="font-weight:bold"> All Documments Verified </span>
                            </label>
                        </div>

                    </div>
                    <div class="col-md-6">
                        <div class="checkbox checkbox-circle checkbox-info peers ai-c">
                            @{
                                if (Model.TransferTo.Any(x => x.ComputerRecord == true))
                                {
                                    <input type="checkbox" value="@Model.TransferTo.Select(x=>x.Id).FirstOrDefault()" id="comp-rec" data-checklst="2" class="peer com-rec-plt-pres" checked>
                                }
                                else
                                {
                                    <input type="checkbox" value="@Model.TransferTo.Select(x=>x.Id).FirstOrDefault()" id="comp-rec" data-checklst="2" class="peer com-rec-plt-pres">
                                }
                            }
                            <label class="peers peer-greed js-sb ai-c">
                                <span class="peer peer-greed ser-ch-nam" style="font-weight:bold"> Computer Record Updated </span>
                            </label>
                        </div>

                    </div>
                </div>
                <div class="form-row" style="margin:15px">
                    <div class="col-md-6">
                        <div class="checkbox checkbox-circle checkbox-info peers ai-c">
                            @{
                                if (Model.TransferTo.Any(x => x.CashPayments == true))
                                {
                                    <input type="checkbox" value="@Model.TransferTo.Select(x=>x.Id).FirstOrDefault()" id="cash-pay" data-checklst="3" class="peer com-rec-plt-pres" checked>
                                }
                                else
                                {
                                    <input type="checkbox" value="@Model.TransferTo.Select(x=>x.Id).FirstOrDefault()" id="cash-pay" data-checklst="3" class="peer com-rec-plt-pres">
                                }
                            }
                            <label class="peers peer-greed js-sb ai-c">
                                <span class="peer peer-greed ser-ch-nam" style="font-weight:bold"> Cash Payments Verified </span>
                            </label>
                        </div>

                    </div>
                    <div class="col-md-6">
                        <div class="checkbox checkbox-circle checkbox-info peers ai-c">
                            @{
                                if (Model.TransferTo.Any(x => x.Cheques_dd_po == true))
                                {
                                    <input type="checkbox" value="@Model.TransferTo.Select(x=>x.Id).FirstOrDefault()" id="chpodd" data-checklst="4" class="peer com-rec-plt-pres" checked>
                                }
                                else
                                {
                                    <input type="checkbox" value="@Model.TransferTo.Select(x=>x.Id).FirstOrDefault()" id="chpodd" data-checklst="4" class="peer com-rec-plt-pres">
                                }
                            }
                            <label class="peers peer-greed js-sb ai-c">
                                <span class="peer peer-greed ser-ch-nam" style="font-weight:bold"> Cheques / PO / DD</span>
                            </label>
                        </div>
                    </div>

                </div>
                <input type="hidden" value="@Model.TransferTo.Select(x=>x.Id).FirstOrDefault()" id="req-id" />
                <input type="hidden" value="@Model.TransferTo.Select(x=>x.GroupTag).FirstOrDefault()" id="grpreq-id" />
                <div class="form-row" id="trns-btn">
                    @if (Model.TransferTo.Any(x => x.Cheques_dd_po == true) && Model.TransferTo.Any(x => x.CashPayments == true) && Model.TransferTo.Any(x => x.ComputerRecord == true) && Model.TransferTo.Any(x => x.AllDocuments == true) && !Model.TransferTo.Any(x => x.Status == 0))
                    {
                        <button class="btn btn-success" data- type="button" id="com-transf-veri" style="width:100%;margin-top:10px">Verified & Ready Transfer</button>
                    }
                </div>
            }
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {

        $('.snd-to-fd-plt').unbind().click(function () {
            if (!confirm('Are you sure you want to send this request back to the counter?')) {
                return;
            }

            let grp = $(this).attr('data-trans');
            $.ajax({
                type: "POST",
                url: '/Transfer/SendBackToCounter/',
                data: { Id: grp, Module: 'CommercialManagement' },
                success: function (data) {
                    if (data) {
                        alert("Request sent back to front desk.");
                        window.location.reload(true);
                    }
                    else {
                        alert("Failed to send this request to front desk.");
                    }
                }
                , error: function (xmlhttprequest, textstatus, message) {
                    if (textstatus === "timeout") {
                        alert("got timeout");
                    } else {
                        alert(textstatus);
                    }
                }
            });
        });

        $('.bio-verif-buyer-plt').unbind().click(function () {
            let grp = $(this).attr('data-trans');
            window.open('/Biometric/BioAuthSetting?Id=' + grp + '&module=CommercialManagement&tp=Transfer', true);
        });
    });
</script>
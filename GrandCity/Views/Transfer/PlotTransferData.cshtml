
@model MeherEstateDevelopers.Models.PlotTransferDetailData
<div class="row gap-20 pos-r">
    <div class="col-md-6">
        <div class="bgc-white p-20 bd">
            <h6 class="c-grey-900">Plot Transfer</h6>
            <div class="mT-30">
                <div class="col-md-12">
                    <div class="form-row">
                        <div class="form-group col-md-2">
                            <label>Plot No.</label>
                            <h5 id="plt-no">@Model.PlotData.Plot_No</h5>
                        </div>
                        <div class="form-group col-md-3">
                            <label>Block</label>
                            <h5 id="plt-size">@Model.PlotData.Block_Name</h5>
                        </div>
                        <div class="form-group col-md-2">
                            <label>Plot Size</label>
                            <h5 id="plt-size">@Model.PlotData.Plot_Size</h5>
                        </div>
                        <div class="form-group col-md-2">
                            <label>Type</label>
                            <h5 id="plt-type">@Model.PlotData.Type</h5>
                        </div>
                        <div class="form-group col-md-3">
                            <label>Dimension</label>
                            <h5 id="plt-dim">@Model.PlotData.Dimension</h5>
                        </div>
                        <div class="form-group col-md-3">
                            <label>Status</label>
                            <h5 id="plt-status">@Model.PlotData.Develop_Status</h5>
                        </div>
                        <div class="form-group col-md-2">
                            <label>Road</label>
                            <h5 id="plt-road">@Model.PlotData.Road_Type</h5>
                        </div>
                        <div class="form-group col-md-2">
                            <label>Area</label>
                            <h5 id="plt-area">@Convert.ToDecimal(Model.PlotData.Area).ToString("0.##") Sq-Ft</h5>
                        </div>
                        <div class="form-group col-md-2">
                            <label>Location</label>
                            <h5 id="plt-loc">@Model.PlotData.Plot_Location</h5>
                        </div>
                    </div>
                </div>
            </div>
            <hr />
            <div class="form-row">
                <div class="col-md-4">
                    <h6 class="c-grey-900">Personal Information</h6>
                </div>
            </div>
            <input type="hidden" class="plotId" value="@Model.PlotData.Id" />
            @{ int counter = 1;}
            @foreach (var v in Model.PlotOwners)
            {
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h5 class="panel-title">
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#@string.Concat("own", counter.ToString())" aria-expanded="true"></a>
                            Owner <span class="own-count-info">@counter</span>
                        </h5>
                    </div>

                    <div class="panel-collapse collapse in show" id="@string.Concat("own", counter.ToString())">
                        <div class="mT-30">
                            <div class="form-row">
                                <div class="form-group col-md-3">
                                    <label>Name</label>
                                    <input type="text" class="form-control" value="@v.Name" id="Name" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>Father's/Husband's Name</label>
                                    <input type="text" class="form-control" id="Father_Husband" value="@v.Father_Husband" readonly>
                                </div>
                                <div class="form-group col-md-5">
                                    <label>Postal Address</label>
                                    <input type="text" class="form-control" id="Postal_Address" value="@v.Postal_Address" readonly>
                                </div>
                                <div class="form-group col-md-5">
                                    <label>Residential Address</label>
                                    <input type="text" class="form-control" id="Residential_Address" value="@v.Residential_Address" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>City</label>
                                    <input type="text" class="form-control" id="City" value="@v.City" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>Date Of Birth</label>
                                    <input type="text" class="form-control" id="Date_Of_Birth" value="@v.Date_Of_Birth" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>CNIC / NICOP</label>
                                    <input type="text" class="form-control" id="CNIC_NICOP" value="@v.CNIC_NICOP" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>Occupation</label>
                                    <input type="text" class="form-control" id="Occupation" value="@v.Occupation" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>Nationality</label>
                                    <input type="text" class="form-control" id="Nationality" value="@v.Nationality" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>Email</label>
                                    <input type="text" class="form-control" id="Email" value="@v.Email" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>Phone Office</label>
                                    <input type="text" class="form-control" id="Phone_Office" value="@v.Phone_Office" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>Residential</label>
                                    <input type="text" class="form-control" id="Residential" value="@v.Residential" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>Mobile 1</label>
                                    <input type="text" class="form-control" id="Mobile_1" value="@v.Mobile_1" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>Mobile 2</label>
                                    <input type="text" class="form-control" id="Mobile_2" value="@v.Mobile_2" readonly>
                                </div>
                                <div class="form-group col-md-6" style="margin:auto;">
                                    <h6 style="width: auto;float: left;margin: 7px;">Filer</h6>
                                    @if (v.IsFiler == true)
                                    {
                                        <label class="switch"><input type="checkbox" class="filerCheck" checked disabled><span class="slider round"></span></label>
                                    }
                                    else
                                    {
                                        <label class="switch"><input type="checkbox" class="filerCheck" disabled><span class="slider round"></span></label>
                                    }
                                </div>
                            </div>
                        </div>
                        <hr />
                        <h6 class="c-grey-900">Nominee</h6>
                        <div class="mT-30">
                            <div class="form-row">
                                <div class="form-group col-md-2">
                                    <label>Name</label>
                                    <input type="text" class="form-control" id="Nominee_Name" value="@v.Nominee_Name" readonly>
                                </div>
                                <div class="form-group col-md-2">
                                    <label>CNIC / NICOP</label>
                                    <input type="text" class="form-control" id="Nominee_CNIC_NICOP" value="@v.Nominee_CNIC_NICOP" readonly>
                                </div>
                                <div class="form-group col-md-2">
                                    <label>Relation</label>
                                    <input class="form-control" id="Nominee_Relation" value="@v.Nominee_Relation" readonly>
                                </div>
                                <div class="form-group col-md-5">
                                    <label>Address</label>
                                    <input type="text" class="form-control" id="Nominee_Address" value="@v.Nominee_Address" readonly>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                counter++;
            }
            <hr />
            <div class="form-row">
                <div class="col-md-2">
                    <label>Booking Price</label>
                    <h6 class="c-grey-900" id="plt-bk-price">@string.Format("{0:n0}", Math.Round(Model.PlotInstallments.Sum(x => x.Amount)))</h6>
                </div>
                <div class="col-md-2">
                    <label>Received</label>
                    <h6 class="c-grey-900" id="rece-amt">@string.Format("{0:n0}", Model.PlotReceipts.Sum(x => x.Amount))</h6>
                </div>
                <div class="col-md-2">
                    <label>Over Due</label>
                    <h6 class="c-grey-900" id="due-amt"></h6>
                </div>
            </div>
            <div class="mT-30">
                <div class="form-row">
                    <div class="col-md-6">
                        <table class="table table-striped table-bordered" cellspacing="0" width="100%" style="margin-bottom:0px">
                            <thead class="thead-dark">
                                <tr><th>Sr.</th></tr>
                            </thead>
                        </table>
                        <div style="min-height:0px; max-height:500px;overflow:auto" class=" ps--active-y">
                            <table class="table table-striped table-bordered" id="all-instments" cellspacing="0" width="100%">
                                <tbody>
                                    @{ foreach (var item in Model.PlotInstallments)
                                        {
                                            <tr>
                                                <td>@item.Installment_Name</td>
                                                <td>@string.Format("{0:n0}", item.Amount)</td>
                                                <td>@string.Format("{0:dd-MMM-yyyy}", item.DueDate)</td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <table class="table table-striped table-bordered" cellspacing="0" width="100%" style="margin-bottom:0px">
                            <thead class="thead-dark">
                                <tr>
                                    <th>Receipt No.</th>
                                    <th>Amount</th>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th></th>
                                </tr>
                            </thead>
                        </table>
                        <div style="min-height:0px; max-height:500px;overflow:auto" class=" ps--active-y">
                            <table class="table table-striped table-bordered" id="rec-amts" cellspacing="0" width="100%">
                                <tbody>
                                    @{ int srcount = 1;
                                        foreach (var item in Model.PlotReceipts)
                                        {
                                            <tr id="@item.Id">
                                                <td>@srcount</td>
                                                <td>@item.ReceiptNo</td>
                                                <td>@string.Format("{0:n0}", item.Amount)</td>
                                                <td>@string.Format("{0:dd-MMM-yyyy}", item.DateTime)</td>
                                                <td>@item.PaymentType</td>
                                            </tr>
                                            srcount++;
                                        }
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="bgc-white p-20 bd">
            <div class="form-row">
                <h5>Transfer To:</h5>
            </div>
            @if (Model.TransferTo.Any(x => x.Transfer_Success != true))
            {
                <button class="btn btn-danger send-bk-req" data-reqId="@Model.TransferTo.Select(x => x.Id).FirstOrDefault()" data-mod="PlotManagement">Send Back to Plots Manager</button>
            }
            <input type="hidden" value="@ViewBag.TransactionId" id="TransactionId" name="TransactionId" />
            <div class="form-row">
                @if (Model.TransferTo.Any(x => x.Blood_Realation == true))
                {
                    <script>
                    var pltsize = "@Model.PlotData.Plot_Size";
                    var type = "@Model.PlotData.Type";
                    var fee = 0;
                            var pltsize = pltsize.split(" ");
                            var fees = pltsize[0] * fee;
                        $("#transfer-fees").val(fees);
                        $("#tras-fee").html(Number(fees).toLocaleString());
                            $("#amt-in-words").val(InWords(fees) + " --  Due To Blood Relation");
                    </script>

                }
                else if (Model.TransferTo.Any(x => x.Wave_Off == true))
                {
                    <script>
                    var pltsize = "@Model.PlotData.Plot_Size";
                        var type = "@Model.PlotData.Type";
                    var rema = "@Model.TransferTo.Select(x => x.Remarks).FirstOrDefault()";

                    var fee = 0;
                            var pltsize = pltsize.split(" ");
                            var fees = pltsize[0] * fee;
                            $("#transfer-fees").val(fees);
                        $("#tras-fee").html(fees + "-" + rema );
                        $("#amt-in-words").val(InWords(fees) + "-" + rema );
                    </script>

                }

                else if (Model.TransferTo.Any(x => x.Dealer_Req == true))
                {
                    <script>
                    var pltsize = "@Model.PlotData.Plot_Size";
                    var type = "@Model.PlotData.Type";
                    var fee = @ViewBag.TransferRate;
                        var pltsize = pltsize.split(" ");
                        var fees = parseFloat(pltsize[0] * fee).toFixed(0);
                            $("#transfer-fees").val(fees);
                        $("#tras-fee").html(Number(fees).toLocaleString());
                            $("#amt-in-words").val(InWords(fees));
                    </script>

                }
                else if (Model.TransferTo.Any(x => x.Other_Transfer_Charges == true))
                {
                    <script>
                    var pltsize = "@Model.PlotData.Plot_Size";
                    var type = "@Model.PlotData.Type";
                        var fee = @Model.TransferTo.Select(x => x.Amount).FirstOrDefault();
                            var pltsize = pltsize.split(" ");
                        var fees = parseFloat(fee).toFixed(0);
                            $("#transfer-fees").val(fees);
                        $("#tras-fee").html(Number(fees).toLocaleString());
                            $("#amt-in-words").val(InWords(fees));
                    </script>

                }
                else if (Model.TransferTo.Any(x => x.Employee_Req == true))
                {
                    <script>
                    var pltsize = "@Model.PlotData.Plot_Size";
                    var type = "@Model.PlotData.Type";
                        var fee = 1000;@*@ViewBag.TransferRate;*@
                        var pltsize = pltsize.split(" ");
                        var fees = parseFloat(pltsize[0] * fee).toFixed(0);
                            $("#transfer-fees").val(fees);
                        $("#tras-fee").html(Number(fees).toLocaleString());
                            $("#amt-in-words").val(InWords(fees));
                    </script>

                }
                else
                {
                    <script>
                    var pltsize = "@Model.PlotData.Plot_Size";
                        var type = "@Model.PlotData.Type";
                        var blk = "@Model.PlotData.Block_Name";
                        var fee = @ViewBag.TransferRate;

                        //if (type == "Commercial") {
                        //    if (blk == "Main G.T Road") {
                        //        fee = 25000;
                        //    }
                        //    else {
                        //        fee = 12000;
                        //    }
                        //}
                        //else {
                        //    fee = 6000
                        //}
                        var pltsize = pltsize.split(" ");
                        var fees = parseFloat(pltsize[0] * fee).toFixed(0);
                            $("#transfer-fees").val(fees);
                        $("#tras-fee").html(Number(fees).toLocaleString());
                            $("#amt-in-words").val(InWords(fees));
                    </script>
                }                

                <h5 style="width:100%">NDC Serial No: @Model.TransferTo.Select(x => x.TransferRequestNo).FirstOrDefault()</h5>
                @*<h5>Transfer Fees: <span id="tras-fee"></span></h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*@
                <h5>Transfer Fees: <input type="text" id="tr_fees" /></h5>
                <h5>Plot Price: <span id="plt-price-fee">@string.Format("{0:n0}", Model.TransferTo.Select(x => x.Plot_Price).FirstOrDefault())</span></h5>
                @if (Model.TransferTo.Any(x => x.Dealer_Req == true))
                {
                    <div class="form-group col-md-12">
                        <h4 style="color:red">Dealer Transfer</h4>
                    </div>
                }
                @if (Model.TransferTo.Any(x => x.Employee_Req == true))
                {
                    <div class="form-group col-md-12">
                        <h4 style="color:red">Employee Transfer</h4>
                    </div>
                }
                @if (Model.TransferTo.Any(x => x.Blood_Realation == true))
                {
                    <div class="form-group col-md-12">
                        <h4 style="color:red">Blood Relation Transfer</h4>
                    </div>
                }
                @if (Model.TransferTo.Any(x => x.Wave_Off == true))
                {
                    <div class="form-group col-md-12">
                        <h4 style="color:red">Transfer Charges Wave Off</h4>
                    </div>
                }
                @if (Model.TransferTo.Any(x => x.TaxExe == true))
                {
                    <div class="form-group col-md-12">
                        <h4 style="color:red">Buyer Tax Exempted</h4>
                    </div>
                }
                @if (Model.TransferTo.Any(x => x.SellerExe == true))
                {
                    <div class="form-group col-md-12">
                        <h4 style="color:red">Seller Tax Exempted</h4>
                    </div>
                }
                <input type="hidden" class="Amount" id="transfer-fees" name="Amount">
                <input type="hidden" id="File_Plot_Number" value="@Model.PlotData.Id" name="File_Plot_Number">
                <input type="hidden" id="TransferRequestId" value="@Model.TransferTo.Select(x => x.Id).FirstOrDefault()" name="TransferRequestId">
                <input type="hidden" id="plt-size" class="Plot_Size" value="@Model.PlotData.Plot_Size" name="Plot_Size">
                <input type="hidden" id="amt-in-words" name="AmountInWords">
                <input type="hidden" id="fp-num" class="FilePlotNumber" value="@Model.PlotData.Plot_No" name="FilePlotNumber">
                <input type="hidden" id="fp-num" class="Block" value="@Model.PlotData.Block_Name" name="Block">
                <input type="hidden" id="buyExe" value="@Model.TransferTo.Select(x=>x.TaxExe).FirstOrDefault()">
                <input type="hidden" id="sellExe" value="@Model.TransferTo.Select(x=>x.SellerExe).FirstOrDefault()">
            </div>

            @{int transCount = 1;}

            @foreach (var v in Model.TransferTo)
            {
                <div class="panel panel-default new-own-data-afkhsjd">
                    <div class="panel-heading">
                        <h5 class="panel-title">
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#@string.Concat("trans",transCount.ToString())" aria-expanded="true"></a>
                            New Owner <span class="own-count-info">@transCount</span>
                        </h5>
                    </div>

                    <div class="panel-collapse collapse in show" id="@string.Concat("trans",transCount.ToString())">
                        <input type="hidden" value="@v.GroupTag" class="GroupTag" />
                        <input type="hidden" value="@v.Plot_Price" class="own-plt-price" />
                        <input type="hidden" value="@v.Plot_Size" class="pl-size" />
                        <div class="form-row">
                            @if (v.IsCompanyProperty == true)
                            {
                                <div class="form-group col-md-12">
                                    <label>Name</label>
                                    <input type="text" class="form-control Name" value="@v.Name" name="Name" id="Name" readonly>
                                </div>
                            }
                            else
                            {
                                <div class="form-group col-md-3">
                                    <label>Name</label>
                                    <input type="text" class="form-control Name" value="@v.Name" name="Name" id="Name" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>Father's/Husband's Name</label>
                                    <input type="text" class="form-control Father_Husband" id="Father_Husband " name="Father_Husband" value="@v.Father_Husband" readonly>
                                </div>
                            }
                            <div class="form-group col-md-5">
                                <label>Postal Address</label>
                                <input type="text" class="form-control Postal_Address" name="Postal_Address" id="Postal_Address" value="@v.Postal_Address" readonly>
                            </div>
                            <div class="form-group col-md-5">
                                <label>Residential Address</label>
                                <input type="text" class="form-control Residential_Address" name="Residential_Address" id="Residential_Address" value="@v.Residential_Address" readonly>
                            </div>
                            <div class="form-group col-md-3">
                                <label>City</label>
                                <input type="text" class="form-control City" id="City" name="City" value="@v.City" readonly>
                            </div>
                            @if (v.IsCompanyProperty == true)
                            {
                                <div class="form-group col-md-3">
                                    <label>Date Of Incorp.</label>
                                    <input type="text" class="form-control Date_Of_Birth" id="Date_Of_Birth" name="Date_Of_Birth" value="@v.Date_Of_Birth" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>NTN</label>
                                    <input type="text" class="form-control CNIC_NICOP" id="CNIC_NICOP" name="CNIC_NICOP" value="@v.CNIC_NICOP" readonly>
                                </div>
                            }
                            else
                            {
                                <div class="form-group col-md-3">
                                    <label>Date Of Birth</label>
                                    <input type="text" class="form-control Date_Of_Birth" id="Date_Of_Birth" name="Date_Of_Birth" value="@v.Date_Of_Birth" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>CNIC / NICOP</label>
                                    <input type="text" class="form-control CNIC_NICOP" id="CNIC_NICOP" name="CNIC_NICOP" value="@v.CNIC_NICOP" readonly>
                                </div>
                            }
                            <div class="form-group col-md-3">
                                <label>Occupation</label>
                                <input type="text" class="form-control Occupation" id="Occupation" name="Occupation" value="@v.Occupation" readonly>
                            </div>
                            <div class="form-group col-md-3">
                                <label>Nationality</label>
                                <input type="text" class="form-control Nationality" id="Nationality" name="Nationality" value="@v.Nationality" readonly>
                            </div>
                            <div class="form-group col-md-3">
                                <label>Email</label>
                                <input type="text" class="form-control Email" id="Email" name="Email" value="@v.Email" readonly>
                            </div>
                            <div class="form-group col-md-3">
                                <label>Phone Office</label>
                                <input type="text" class="form-control Phone_Office" id="Phone_Office" name="Phone_Office" value="@v.Phone_Office" readonly>
                            </div>
                            <div class="form-group col-md-3">
                                <label>Residential</label>
                                <input type="text" class="form-control Residential" id="Residential" name="Residential" value="@v.Residential" readonly>
                            </div>
                            <div class="form-group col-md-3">
                                <label>Mobile 1</label>
                                <input type="text" class="form-control Mobile_1" id="Mobile_1" name="Mobile_1" value="@v.Mobile_1" readonly>
                            </div>
                            <div class="form-group col-md-3">
                                <label>Mobile 2</label>
                                <input type="text" class="form-control Mobile_2" id="Mobile_2" name="Mobile_2" value="@v.Mobile_2" readonly>
                            </div>
                            <div class="form-group col-md-6" style="margin:auto;">
                                <h6 style="width: auto;float: left;margin: 7px;">Filer</h6>
                                @if (v.IsFiler == true)
                                {
                                    <label class="switch"><input type="checkbox" class="filerCheck" checked disabled><span class="slider round"></span></label>
                                }
                                else
                                {
                                    <label class="switch"><input type="checkbox" class="filerCheck" disabled><span class="slider round"></span></label>
                                }
                            </div>
                        </div>
                        <hr />
                        <h6 class="c-grey-900">Nominee</h6>
                        <div class="mT-40">
                            <div class="form-row">
                                <div class="form-group col-md-3">
                                    <label>Name</label>
                                    <input type="text" class="form-control Nominee_Name" id="Nominee_Name" name="Nominee_Name" value="@v.Nominee_Name" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>CNIC / NICOP</label>
                                    <input type="text" class="form-control Nominee_CNIC_NICOP" id="Nominee_CNIC_NICOP" name="Nominee_CNIC_NICOP" value="@v.Nominee_CNIC_NICOP" readonly>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>Relation</label>
                                    <input class="form-control Nominee_Relation" id="Nominee_Relation" name="Nominee_Relation" value="@v.Nominee_Relation" readonly>
                                </div>
                                <div class="form-group col-md-10">
                                    <label>Address</label>
                                    <input type="text" class="form-control Nominee_Address" id="Nominee_Address" name="Nominee_Address" value="@v.Nominee_Address" readonly>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                transCount++;
            }

            @if (Model.TransferTo.Any(x => x.Transfer_Success != true))
            {
                <hr style="border-top:13px solid red" />
                <h3 style="text-align:center">Tax Calculations</h3>
                <hr style="border-top:13px solid red" />

                <hr style="border-top:3px solid green" />
                <h3 style="text-align:center">Buyer Tax Calculations</h3>
                <hr style="border-top:3px solid green" />
                <div class="row">
                    @{ decimal pltVal = (decimal)Model.TransferTo.Select(x => x.Plot_Price).FirstOrDefault();}
                    @foreach (var v in Model.TransferTo)
                    {
                        if (Model.TransferTo.Any(x => x.TaxExe))
                        {
                            <div class="col-md-6">
                                <label>@v.Name (Exempted) :</label>
                            </div>

                            <div class="col-md-6">
                                <label><b>0</b></label>
                            </div>
                        }
                        else
                        {
                            <div class="col-md-6">
                                <label>@v.Name (@((v.IsFiler == true)?"Filer":"Non Filer")) :</label>
                            </div>

                            <div class="col-md-6">
                                @if (v.IsFiler == true)
                                {
                                    <label><b>@(string.Format("{0:n0}",((decimal)pltVal/Model.TransferTo.Count())*(decimal)ViewBag.Buyer_filerRate))</b></label>
                                }
                                else
                                {
                                    <label><b>@(string.Format("{0:n0}",((decimal)pltVal/Model.TransferTo.Count())*(decimal)ViewBag.Buyer_nonFilerRate))</b></label>
                                }
                            </div>
                        }
                    }
                </div>

                <hr style="border-top:3px solid green" />
                <h3 style="text-align:center">Seller's Tax Calculations</h3>
                <hr style="border-top:3px solid green" />
                <div class="row">

                    @foreach (var v in Model.PlotOwners)
                    {
                        if (Model.TransferTo.Any(x => x.SellerExe))
                        {
                            <div class="col-md-6">
                                <label>@v.Name (Exempted) :</label>
                            </div>

                            <div class="col-md-6">
                                <label><b>0</b></label>
                            </div>
                        }
                        else
                        {
                            <div class="col-md-6">
                                <label>@v.Name (@((v.IsFiler == true)?"Filer":"Non Filer")) :</label>
                            </div>

                            <div class="col-md-6">
                                @{
                                    string[] types = { "Booking", "Installment", "Advance" };
                                    var lastInstDate = Model.PlotReceipts.Where(x => types.Contains(x.Type)).OrderByDescending(x => x.DateTime).Select(x => x.DateTime).FirstOrDefault();
                                    v.Ownership_DateTime = (v.Ownership_DateTime.Value.Date < lastInstDate.Value.Date) ? lastInstDate : v.Ownership_DateTime;
                                }
                                @if (ViewBag.isExp)
                                {
                                    if ((DateTime.Now - v.Ownership_DateTime.Value).TotalDays <= ViewBag.ExpDays)
                                    {
                                        if (v.IsFiler == true)
                                        {
                                            <label><b>@(string.Format("{0:n0}",((decimal)pltVal/Model.PlotOwners.Count())*(decimal)ViewBag.Seller_filerRate))</b></label>
                                        }
                                        else
                                        {
                                            <label><b>@(string.Format("{0:n0}",((decimal)pltVal/Model.PlotOwners.Count())*(decimal)ViewBag.Seller_nonFilerRate))</b></label>
                                        }
                                    }
                                    else
                                    {
                                        <label><b>0 (Tax Exempted since own duration > @ViewBag.ExpDays Days)</b></label>
                                    }
                                }
                                else
                                {
                                    if (v.IsFiler == true)
                                    {
                                        <label><b>@(string.Format("{0:n0}",((decimal)pltVal/Model.PlotOwners.Count())*(decimal)ViewBag.Seller_filerRate))</b></label>
                                    }
                                    else
                                    {
                                        <label><b>@(string.Format("{0:n0}",((decimal)pltVal/Model.PlotOwners.Count())*(decimal)ViewBag.Seller_nonFilerRate))</b></label>
                                    }
                                }
                            </div>
                        }
                    }
                </div>

                <hr style="border-top:13px solid red" />
                <h3 style="text-align:center">Check List of NDC</h3>
                <hr style="border-top:13px solid red" />
                <div class="form-row" style="margin:15px">
                    <div class="col-md-6">
                        <div class="checkbox checkbox-circle checkbox-info peers ai-c">
                            @{
                                if (Model.TransferTo.Any(x => x.AllDocuments == true))
                                {
                                    <input type="checkbox" class="peer" checked>
                                }
                                else
                                {
                                    <input type="checkbox" class="peer">
                                }
                            }
                            <label class="peers peer-greed js-sb ai-c">
                                <span class="peer peer-greed ser-ch-nam" style="font-weight:bold"> All Documments Verified </span>
                            </label>
                        </div>

                    </div>
                    <div class="col-md-6">
                        <div class="checkbox checkbox-circle checkbox-info peers ai-c">
                            @{
                                if (Model.TransferTo.Any(x => x.ComputerRecord == true))
                                {
                                    <input type="checkbox" class="peer " checked>
                                }
                                else
                                {
                                    <input type="checkbox" class="peer ">
                                }
                            }
                            <label class="peers peer-greed js-sb ai-c">
                                <span class="peer peer-greed ser-ch-nam" style="font-weight:bold"> Computer Record Updated </span>
                            </label>
                        </div>

                    </div>
                </div>
                <div class="form-row" style="margin:15px">
                    <div class="col-md-6">
                        <div class="checkbox checkbox-circle checkbox-info peers ai-c">
                            @{
                                if (Model.TransferTo.Any(x => x.CashPayments == true))
                                {
                                    <input type="checkbox" class="peer " checked>
                                }
                                else
                                {
                                    <input type="checkbox" class="peer ">
                                }
                            }
                            <label class="peers peer-greed js-sb ai-c">
                                <span class="peer peer-greed ser-ch-nam" style="font-weight:bold"> Cash Payments Verified </span>
                            </label>
                        </div>

                    </div>
                    <div class="col-md-6">
                        <div class="checkbox checkbox-circle checkbox-info peers ai-c">
                            @{
                                if (Model.TransferTo.Any(x => x.Cheques_dd_po == true))
                                {
                                    <input type="checkbox" class="peer " readonly checked>
                                }
                                else
                                {
                                    <input type="checkbox" class="peer ">
                                }
                            }
                            <label class="peers peer-greed js-sb ai-c">
                                <span class="peer peer-greed ser-ch-nam" style="font-weight:bold"> Cheques / Pay Orders / Demand Drafts </span>
                            </label>
                        </div>
                    </div>

                </div>
                <div class="form-row" id="trns-btn">
                    @if (Model.TransferTo.Any(x => x.Cheques_dd_po == true) && Model.TransferTo.Any(x => x.CashPayments == true && x.ComputerRecord == true && x.AllDocuments == true))
                    {
                        <script>

                        </script>
                        <input type="hidden" value="@Model.TransferTo.Select(x=>x.Id).FirstOrDefault()" id="req-id" />
                        <button class="btn btn-success trans-frm-khfjsda" type="submit" id="" style="width:100%;margin-top:10px">Transfer</button>
                    }
                </div>
            }
        </div>
    </div>
</div>

<script>
    $('.trans-frm-khfjsda').unbind().click(function () {
        debugger;
        let confi = confirm('Are you sure you want to finalize transfer?');
        if (!confi) {
            return;
        }
        debugger;
        $('.trans-frm-khfjsda').prop('disabled', true);
        
        let transferFeesInput = $('#tr_fees').val();
        let amountInWords = InWords(transferFeesInput); // Convert the value to words
        let ownsData = [];
        let transReqNum = $('#TransferRequestId').val();
        let transaction = $('#TransactionId').val();
        let pltId = $('.plotId').val();
        $('.new-own-data-afkhsjd').each(function () {
            var prnt = $(this);
            var plotowndata = {
                Plot_Size: $(prnt).find(".pl-size").val(), 
                Name: $(prnt).find(".Name").val(),
                Father_Husband: $(prnt).find(".Father_Husband").val(),
                Postal_Address: $(prnt).find(".Postal_Address").val(),
                Residential_Address: $(prnt).find(".Residential_Address").val(),
                Phone_Office: $(prnt).find(".Phone_Office").val(),
                Residential: $(prnt).find(".Residential").val(),
                Mobile_1: $(prnt).find(".Mobile_1").val(),
                Mobile_2: $(prnt).find(".Mobile_2").val(),
                Email: $(prnt).find(".Email").val(),
                Occupation: $(prnt).find(".Occupation").val(),
                Nationality: $(prnt).find(".Nationality").val(),
                Date_Of_Birth: $(prnt).find(".Date_Of_Birth").val(),
                CNIC_NICOP: $(prnt).find(".CNIC_NICOP").val(),
                Ownership_DateTime: $(prnt).find(".Ownership_DateTime").val(),
                Nominee_Name: $(prnt).find(".Nominee_Name").val(),
                Nominee_Relation: $(prnt).find(".Nominee_Relation").val(),
                Nominee_Address: $(prnt).find(".Nominee_Address").val(),
                Nominee_CNIC_NICOP: $(prnt).find(".Nominee_CNIC_NICOP").val(),
                DateTime: $(prnt).find(".DateTime").val(),
                Ownership_Status: $(prnt).find(".Ownership_Status").val(),
                Plot_Id: $("#plt-id").val(),
                GroupTag: $(prnt).find(".GroupTag").val(),
                Total_Price: $(".own-plt-price").val(),
                City: $(prnt).find(".City").val(),
                IsFiler: $(prnt).find(".filerCheck").is(":checked"),
            }
            ownsData.push(plotowndata);
        });

        let receiptData = {
            AmountInWords: amountInWords,
            Amount: transferFeesInput,
            File_Plot_Number: $('#File_Plot_Number').val(),
            Plot_Size: $('#plt-size').val(),
            FilePlotNumber: $('.FilePlotNumber').val(),
            Block: $('.Block').val()
        };

        $.ajax({
            type: "POST",
            url: "/Transfer/SavePlotTransfer/",
            contentType: "application/json",
            traditional: true,
            beforeSend: function () {

            },
            complete: function () {

            },
            data: JSON.stringify({ PO: ownsData, rd: receiptData, TransferRequestId: transReqNum, TransactionId: transaction, Plot_Id: pltId }),
        }).done(function (data) {
            if (data == false) {
                alert('unable to process the transfer');
            }
            else {
                alert('Transfer has been completed.');
                window.open('/Receipts/TaxReceipt?Token=' + data.ReceiptId);

                window.location.reload();
            }
        });

    });
</script>
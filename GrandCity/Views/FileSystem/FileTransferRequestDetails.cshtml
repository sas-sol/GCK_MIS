@model MeherEstateDevelopers.Models.TransferRequestDetails
<!-- SweetAlert2 CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<!-- SweetAlert2 JS -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
@{ Layout = "~/Views/Shared/_StaffLayout.cshtml"; }
<div class="row gap-20 pos-r">
    <div class="col-md-12">
        <div class="bgc-white p-20 bd">
            <h6 class="c-grey-900">Application File Form</h6>
            <div class="mT-30">
                <div class="form-row row">
                    <div class="col-md-12">
                        <div class="form-row">
                            <div class="form-group col-md-2">
                                <label>File Form No.</label>
                                <input type="text" value="@Model.File.File_Form_Number" class="form-control" id="app-num" readonly>
                            </div>
                            <div class="form-group col-md-3">
                                <label>Dealership</label>
                                <input type="text" class="form-control" value="@Model.File.Dealership_Name" id="deal-nam" readonly>
                            </div>
                            <div class="form-group col-md-2">
                                <label>Plot Size</label>
                                <input type="text" class="form-control" value="@Model.File.Plot_Size" id="pl-size" readonly>
                            </div>
                            <div class="form-group col-md-2">
                                <label>Project</label>
                                <input type="text" class="form-control" value="@Model.File.Project_Name" id="prj" readonly>
                            </div>
                            <div class="form-group col-md-2">
                                <label>Phase</label>
                                <input type="text" class="form-control" value="@Model.File.Phase_Name" id="phs" readonly>
                            </div>
                            <div class="form-group col-md-2">
                                <label>Block</label>
                                <input type="text" class="form-control" id="blk" value="@Model.File.Block_Name" readonly>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="col-md-3">
                                <h5>File Status : &nbsp; @Model.File.Status</h5>
                            </div>
                            <div class="col-md-5">
                                @{
                                    var dev = "";
                                    if (Model.File.Development_Charges_Val == true) { dev = "With Development Charges"; } else if (Model.File.Development_Charges_Val == false) { dev = "Non Development Charges"; }

                                }
                                <h3 id="dev-char">@dev</h3>
                            </div>
                            <div class="col-md-4">
                                <h5>Balance : &nbsp;@string.Format("{0:n0}", Model.File.Balance_Amount)</h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="bgc-white p-20 bd">

            <h6 class="c-grey-900">Personal Information</h6>
            <div class="mT-30">
                <div class="form-row">
                    <div class="form-group col-md-3">
                        <label>Name</label>
                        <input type="text" class="form-control" value="@Model.File.Name" id="Name" readonly>
                    </div>
                    <div class="form-group col-md-3">
                        <label>Father's/Husband's Name</label>
                        <input type="text" class="form-control" id="Father_Husband" value="@Model.File.Father_Husband" readonly>
                    </div>
                    <div class="form-group col-md-5">
                        <label>Postal Address</label>
                        <input type="text" class="form-control" id="Postal_Address" value="@Model.File.Postal_Address" readonly>
                    </div>
                    <div class="form-group col-md-5">
                        <label>Residential Address</label>
                        <input type="text" class="form-control" id="Residential_Address" value="@Model.File.Residential_Address" readonly>
                    </div>
                    <div class="form-group col-md-3">
                        <label>City</label>
                        <input type="text" class="form-control" id="City" value="@Model.File.City" readonly>
                    </div>
                    <div class="form-group col-md-3">
                        <label>Date Of Birth</label>
                        <input type="text" class="form-control" id="Date_Of_Birth" value="@Model.File.Date_Of_Birth" readonly>
                    </div>
                    <div class="form-group col-md-3">
                        <label>CNIC / NICOP</label>
                        <input type="text" class="form-control" id="CNIC_NICOP" value="@Model.File.CNIC_NICOP" readonly>
                    </div>
                    <div class="form-group col-md-3">
                        <label>Occupation</label>
                        <input type="text" class="form-control" id="Occupation" value="@Model.File.Occupation" readonly>
                    </div>
                    <div class="form-group col-md-3">
                        <label>Nationality</label>
                        <input type="text" class="form-control" id="Nationality" value="@Model.File.Nationality" readonly>
                    </div>
                    <div class="form-group col-md-3">
                        <label>Email</label>
                        <input type="text" class="form-control" id="Email" value="@Model.File.Email" readonly>
                    </div>
                    <div class="form-group col-md-3">
                        <label>Phone Office</label>
                        <input type="text" class="form-control" id="Phone_Office" value="@Model.File.Phone_Office" readonly>
                    </div>
                    <div class="form-group col-md-3">
                        <label>Residential</label>
                        <input type="text" class="form-control" id="Residential" value="@Model.File.Residential" readonly>
                    </div>
                    <div class="form-group col-md-3">
                        <label>Mobile 1</label>
                        <input type="text" class="form-control" id="Mobile_1" value="@Model.File.Mobile_1" readonly>
                    </div>
                    <div class="form-group col-md-3">
                        <label>Mobile 2</label>
                        <input type="text" class="form-control" id="Mobile_2" value="@Model.File.Mobile_2" readonly>
                    </div>
                </div>
            </div>
            <hr />
            <h6 class="c-grey-900">Nominee</h6>
            <div class="mT-30">
                <div class="form-row">
                    <div class="form-group col-md-2">
                        <label>Name</label>
                        <input type="text" class="form-control" id="Nominee_Name" value="@Model.File.Nominee_Name" readonly>
                    </div>
                    <div class="form-group col-md-2">
                        <label>CNIC / NICOP</label>
                        <input type="text" class="form-control" id="Nominee_CNIC_NICOP" value="@Model.File.Nominee_CNIC_NICOP" readonly>
                    </div>
                    <div class="form-group col-md-2">
                        <label>Relation</label>
                        <input class="form-control" id="Nominee_Relation" value="@Model.File.Nominee_Relation" readonly>
                    </div>
                    <div class="form-group col-md-5">
                        <label>Address</label>
                        <input type="text" class="form-control" id="Nominee_Address" value="@Model.File.Nominee_Address" readonly>
                    </div>
                </div>
            </div>
            <hr />
            <h6 class="c-grey-900">Installments</h6>
            <div class="mT-30">
                <div class="form-row">
                    <div class="col-md-12">
                        <table class="table table-striped table-bordered" cellspacing="0" width="100%" style="margin-bottom:0px">
                            <thead class="thead-dark">
                                <tr>
                                    <th>Sr.</th>
                                    <th></th>
                                </tr>
                            </thead>
                        </table>
                        <div style="min-height:0px; max-height:500px;overflow:auto" class=" ps--active-y">
                            <table class="table table-striped table-bordered" id="all-instments" cellspacing="0" width="100%">
                                <tbody>
                                    @{ int serno = 1; }
                                    @foreach (var item in Model.Installments)
                                    {
                                        string statuscolor = "";
                                        if (item.Status == "NotPaid")
                                        {
                                            statuscolor = "bgc-red-50";
                                        }
                                        else if (item.Status == "Paid")
                                        {
                                            statuscolor = "bgc-green-50";
                                        }
                                        <tr class="@statuscolor" id="@item.Id">
                                            <td>@serno</td>
                                            <td>@string.Format("{0:MMMM yyyy}", item.Due_Date), @item.Installment_Name</td>
                                            <td>@string.Format("{0:n0}", item.Amount)</td>
                                            <td>@item.Status</td>
                                        </tr>
                                        serno++;
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div style="min-height:0px; max-height:500px;overflow:auto" class=" ps--active-y">
                            <table class="table table-striped table-bordered" id="oth-inst" cellspacing="0" width="100%">
                                <thead class="thead-dark">
                                    <tr>
                                        <th>Sr.</th>
                                        <th>Installment Name</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{ int serno1 = 1; }
                                    @foreach (var item in Model.OtherInstallments)
                                    {
                                        string statuscolor = "";
                                        if (item.Status == "NotPaid")
                                        {
                                            statuscolor = "bgc-red-50";
                                        }
                                        else if (item.Status == "Paid")
                                        {
                                            statuscolor = "bgc-green-50";
                                        }
                                        <tr class="@statuscolor" id="@item.Id">
                                            <td>@serno1</td>
                                            <td>@string.Format("{0:MMMM yyyy}", item.Due_Date), @item.Installment_Name</td>
                                            <td>@string.Format("{0:n0}", item.Amount)</td>
                                            <td>@item.Status</td>
                                        </tr>
                                        serno1++;
                                    }
                                </tbody>
                            </table>
                        </div>
                        <div style="min-height:0px; max-height:500px;overflow:auto" class=" ps--active-y">
                            <table class="table table-striped table-bordered" id="rec-amts" cellspacing="0" width="100%">
                                <thead class="thead-dark">
                                    <tr>
                                        <th>Receipt No.</th>
                                        <th>Amount</th>
                                        <th>Date</th>
                                        <th>Type</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.ReceivedAmounts)
                                    {
                                        <tr>
                                            <td>@item.ReceiptNo</td>
                                            <td>@string.Format("{0:n0}", item.Amount)</td>
                                            <td>@string.Format("{0:dd-MMM-yyyy}", item.DateTime)</td>
                                            <td>@item.PaymentType</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="bgc-white p-20 bd">
            <div class="form-row">
                <h5>
                    Transfer To: &nbsp; &nbsp;
                    @if (Model.TransferTo.Any(x => x.Status != 0))
                    {
                        <span>| &nbsp;&nbsp;</span><button class="btn btn-primary snd-to-fd-btn" type="button" data-grp="@Model.TransferTo.Select(x=>x.Group_Tag).FirstOrDefault()">Send Back To Front Desk</button>
                    }
                    <span>| &nbsp; &nbsp;</span><button class="btn btn-primary bio-verif-buyer-fl" data-trans="@Model.TransferTo.Select(x=>x.Group_Tag).FirstOrDefault()"><i class="fas fa-fingerprint"></i> Biometric Record</button>
                </h5>
                <h5 style="width:100%">NDC Serial No: @Model.TransferTo.Select(x => x.TransferReqNo).FirstOrDefault()</h5>
                <input type="hidden" id="file-id" value="@Model.File.Id" name="File_Form_Id">
            </div>
            <div class="form-row row">
                @*@if (Model.TransferTo.Dealer_Req == true)
            {
                <div class="form-group col-md-6">
                    <h4 style="color:red">Dealer Transfer</h4>

                </div>
            }
            @if (Model.TransferTo.Employee_Req == true)
            {
                <div class="form-group col-md-6">
                    <h4 style="color:red">Employee Transfer</h4>
                </div>
            }*@
                <div class="form-group col-md-6">
                    <h6 style="width: auto;float: left;margin: 7px;">Blood Relation Transfer</h6>
                    <label class="switch"><input type="checkbox" id="bl-rel"><span class="slider round"></span></label>
                </div>
                <div class="form-group col-md-6">
                    <h6 style="width: auto;float: left;margin: 7px;">Transfer Charges Wave off</h6>
                    <label class="switch"><input type="checkbox" id="tran-ch"><span class="slider round"></span></label>
                </div>
                <div class="form-group col-md-6">
                    <h6 style="width: auto;float: left;margin: 7px;">Other Transfer Charges</h6>
                    <label class="switch"><input type="checkbox" id="oth-tran-ch"><span class="slider round"></span></label>
                </div>
                <div class="form-group col-md-6 tran-amt" style="display:none">
                    <label>Rate / Marla</label>
                    <input class="form-control coma" placeholder="12,345" required>
                    <input type="hidden" id="amt" name="Amount" class="amt" required>
                </div>
                <div class="form-group col-md-6 remarks" style="display:none">
                    <label>Remarks</label>
                    <textarea class="form-control" id="remarks"></textarea>
                </div>
                <input type="hidden" id="blod-rel" value="false" />
                <input type="hidden" id="Trans-val" value="false" />
                <input type="hidden" id="oth-Trans-val" value="false" />
            </div>
            <hr />
            @{ int cnt = 1;}
            @foreach (var item in Model.TransferTo)
            {
                <h5 style="text-align:center;">Owner # @(cnt++)</h5>
                <hr />
                <div class="form-row">
                    @if (Model.TransferTo.Any(x => x.IsCompanyProperty == true))
                    {
                        <div class="form-group col-md-6">
                            <label>Company Name</label>
                            <input type="text" class="form-control" value="@item.Name" id="Name" readonly>
                        </div>
                    }
                    else
                    {
                        <div class="form-group col-md-3">
                            <label>Name</label>
                            <input type="text" class="form-control" value="@item.Name" id="Name" readonly>
                        </div>
                        <div class="form-group col-md-3">
                            <label>Father's/Husband's Name</label>
                            <input type="text" class="form-control" id="Father_Husband" value="@item.Father_Husband" readonly>
                        </div>
                    }
                    <div class="form-group col-md-5">
                        <label>Postal Address</label>
                        <input type="text" class="form-control" id="Postal_Address" value="@item.Postal_Address" readonly>
                    </div>
                    <div class="form-group col-md-5">
                        <label>Residential Address</label>
                        <input type="text" class="form-control" id="Residential_Address" value="@item.Residential_Address" readonly>
                    </div>
                    <div class="form-group col-md-3">
                        <label>City</label>
                        <input type="text" class="form-control" id="City" value="@item.City" readonly>
                    </div>
                    @if (Model.TransferTo.Any(x => x.IsCompanyProperty == true))
                    {
                        <div class="form-group col-md-3">
                            <label>Date Of Incorp.</label>
                            <input type="text" class="form-control" id="Date_Of_Birth" value="@item.Date_Of_Birth" readonly>
                        </div>
                        <div class="form-group col-md-3">
                            <label>NTN</label>
                            <input type="text" class="form-control" id="CNIC_NICOP" value="@item.CNIC_NICOP" readonly>
                        </div>
                    }
                    else
                    {
                        <div class="form-group col-md-3">
                            <label>Date Of Birth</label>
                            <input type="text" class="form-control" id="Date_Of_Birth" value="@item.Date_Of_Birth" readonly>
                        </div>
                        <div class="form-group col-md-3">
                            <label>CNIC / NICOP</label>
                            <input type="text" class="form-control" id="CNIC_NICOP" value="@item.CNIC_NICOP" readonly>
                        </div>
                    }
                    <div class="form-group col-md-3">
                        <label>Occupation</label>
                        <input type="text" class="form-control" id="Occupation" value="@item.Occupation" readonly>
                    </div>
                    <div class="form-group col-md-3">
                        <label>Nationality</label>
                        <input type="text" class="form-control" id="Nationality" value="@item.Nationality" readonly>
                    </div>
                    <div class="form-group col-md-3">
                        <label>Email</label>
                        <input type="text" class="form-control" id="Email" value="@item.Email" readonly>
                    </div>
                    <div class="form-group col-md-3">
                        <label>Phone Office</label>
                        <input type="text" class="form-control" id="Phone_Office" value="@item.Phone_Office" readonly>
                    </div>
                    <div class="form-group col-md-3">
                        <label>Residential</label>
                        <input type="text" class="form-control" id="Residential" value="@item.Residential" readonly>
                    </div>
                    <div class="form-group col-md-3">
                        <label>Mobile 1</label>
                        <input type="text" class="form-control" id="Mobile_1" value="@item.Mobile_1" readonly>
                    </div>
                    <div class="form-group col-md-3">
                        <label>Mobile 2</label>
                        <input type="text" class="form-control" id="Mobile_2" value="@item.Mobile_2" readonly>
                    </div>
                </div>
                <hr />
                if (Model.TransferTo.Any(x => x.IsCompanyProperty == true))
                {
                    <h6 class="c-grey-900">Board Resolution</h6>
                }
                else
                {
                    <h6 class="c-grey-900">Nominee</h6>
                }
                <div class="mT-40">
                    <div class="form-row">
                        <div class="form-group col-md-3">
                            <label>Name</label>
                            <input type="text" class="form-control" id="Nominee_Name" value="@item.Nominee_Name" readonly>
                        </div>
                        <div class="form-group col-md-3">
                            <label>CNIC / NICOP</label>
                            <input type="text" class="form-control" id="Nominee_CNIC_NICOP" value="@item.Nominee_CNIC_NICOP" readonly>
                        </div>
                        <div class="form-group col-md-3">
                            <label>Relation</label>
                            <input class="form-control" id="Nominee_Relation" value="@item.Nominee_Relation" readonly>
                        </div>
                        <div class="form-group col-md-10">
                            <label>Address</label>
                            <input type="text" class="form-control" id="Nominee_Address" value="@item.Nominee_Address" readonly>
                        </div>
                    </div>
                </div>
            }

            <hr style="border-top:13px solid red" />
            <h3 style="text-align:center">Check List of NDC</h3>
            <hr style="border-top:13px solid red" />
            @if (Model.TransferTo.Any(x => x.Transfer_Success != true && x.Status != 0))
            {
                <div class="form-row" style="margin:15px">
                    <div class="col-md-6">
                        <div class="checkbox checkbox-circle checkbox-info peers ai-c">
                            @{
                                if (Model.TransferTo.Any(x => x.AllDocuments == true))
                                {
                                    <input type="checkbox" value="@Model.TransferTo.Select(x=>x.Id).FirstOrDefault()" id="all-doc" data-checklst="1" class="peer rec-pres" checked>
                                }
                                else
                                {
                                    <input type="checkbox" value="@Model.TransferTo.Select(x=>x.Id).FirstOrDefault()" id="all-doc" data-checklst="1" class="peer rec-pres">
                                }
                            }
                            <label class="peers peer-greed js-sb ai-c">
                                <span class="peer peer-greed ser-ch-nam" style="font-weight:bold"> All Documents Verified </span>
                            </label>
                        </div>

                    </div>
                    <div class="col-md-6">
                        <div class="checkbox checkbox-circle checkbox-info peers ai-c">
                            @{
                                if (Model.TransferTo.Any(x => x.ComputerRecord == true))
                                {
                                    <input type="checkbox" value="@Model.TransferTo.Select(x=>x.Id).FirstOrDefault()" id="comp-rec" data-checklst="2" class="peer rec-pres" checked>
                                }
                                else
                                {
                                    <input type="checkbox" value="@Model.TransferTo.Select(x=>x.Id).FirstOrDefault()" id="comp-rec" data-checklst="2" class="peer rec-pres">
                                }
                            }
                            <label class="peers peer-greed js-sb ai-c">
                                <span class="peer peer-greed ser-ch-nam" style="font-weight:bold"> Computer Record Updated </span>
                            </label>
                        </div>

                    </div>
                </div>

                <div class="form-row" style="margin:15px">
                    <div class="col-md-6">
                        <div class="checkbox checkbox-circle checkbox-info peers ai-c">
                            @{
                                if (Model.TransferTo.Any(x => x.CashPayments == true))
                                {
                                    <input type="checkbox" value="@Model.TransferTo.Select(x=>x.Id).FirstOrDefault()" id="cash-pay" data-checklst="3" class="peer rec-pres" checked>
                                }
                                else
                                {
                                    <input type="checkbox" value="@Model.TransferTo.Select(x=>x.Id).FirstOrDefault()" id="cash-pay" data-checklst="3" class="peer rec-pres">
                                }
                            }
                            <label class="peers peer-greed js-sb ai-c">
                                <span class="peer peer-greed ser-ch-nam" style="font-weight:bold"> Cash Payments Verified </span>
                            </label>
                        </div>

                    </div>
                    <div class="col-md-6">
                        <div class="checkbox checkbox-circle checkbox-info peers ai-c">
                            @{
                                if (Model.TransferTo.Any(x => x.Cheques_dd_po == true))
                                {
                                    <input type="checkbox" value="@Model.TransferTo.Select(x=>x.Id).FirstOrDefault()" id="chpodd" data-checklst="4" class="peer rec-pres" checked>
                                }
                                else
                                {
                                    <input type="checkbox" value="@Model.TransferTo.Select(x=>x.Id).FirstOrDefault()" id="chpodd" data-checklst="4" class="peer rec-pres">
                                }
                            }
                            <label class="peers peer-greed js-sb ai-c">
                                <span class="peer peer-greed ser-ch-nam" style="font-weight:bold"> Cheques / Pay Orders / Demand Drafts </span>
                            </label>
                        </div>
                    </div>

                </div>
                <input type="hidden" value="@Model.TransferTo.Select(x=>x.Id).FirstOrDefault()" id="req-id" />
                <div class="form-row" id="trns-btn">
                    @if (Model.TransferTo.Any(x => x.Cheques_dd_po == true) && Model.TransferTo.Any(x => x.CashPayments == true) && Model.TransferTo.Any(x => x.ComputerRecord == true) && Model.TransferTo.Any(x => x.AllDocuments == true))
                    {
                        <button class="btn btn-success" data- type="button" id="transf-veri" style="width:100%;margin-top:10px">Verified & Ready Transfer</button>
                    }
                </div>
            }
            else
            {
                <h3>This is Already Transfered</h3>
            }
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('.snd-to-fd-btn').unbind().click(function () {
            //if (!confirm('Are you sure you want to send this request back to the counter?')) {
            //    return;
            //}
            Swal.fire({
                text: 'Are you certain you want to return this request to the counter?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Yes',
                cancelButtonText: 'No'
            }).then((result) => {
                if (!result.isConfirmed) {
                    return;
                }
                else {
                    let grp = $(this).attr('data-grp');
                    $.ajax({
                        type: "POST",
                        url: '/Transfer/SendBackToCounter/',
                        data: { Id: grp, Module: 'FileManagement' },
                        success: function (data) {
                            if (data) {
                                //alert("Request sent back to front desk.");
                                Swal.fire({
                                    icon: 'success',
                                    text: 'Request has been returned to the front desk successfully'
                                }).then(() => {
                                    window.location.reload(true);
                                });
                            }
                            else {
                                //alert("Failed to send this request to front desk.");
                                Swal.fire({
                                    icon: 'error',
                                    text: 'Something went wrong'
                                });
                            }
                        }
                        , error: function (xmlhttprequest, textstatus, message) {
                            if (textstatus === "timeout") {
                                //alert("got timeout");
                                Swal.fire({
                                    icon: 'error',
                                    text: 'Request timed out'
                                });
                            } else {
                                //alert(textstatus);
                                Swal.fire({
                                    icon: 'error',
                                    text: 'Something went wrong'
                                });
                            }
                        }
                    });
                }
            });
        });

        $('.bio-verif-buyer-fl').unbind().click(function () {
            let grp = $(this).attr('data-trans');
            window.open('/Biometric/BioAuthSetting?Id=' + grp + '&module=FileManagement&tp=Transfer', true);
        });
    });
</script>
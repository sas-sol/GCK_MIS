@model IEnumerable<MeherEstateDevelopers.Models.Sp_Get_All_Employess_Salaries_Result>
@*@{ Layout = "~/Views/Shared/_StaffLayout.cshtml"; }*@
<style>
    table thead tr th, table tbody tr td {
        font-size: 12px;
    }

    .scrolling-box {
        height: 740px;
        overflow-y: scroll;
        overflow-x: scroll;
        width: 100%;
    }

    .tableFixHead {
        overflow: auto;
        height: 700px;
    }

        .tableFixHead .ka th {
            position: sticky;
            top: 0;
        }
</style>
<div class="bgc-white bd bdrs-3 p-20 mB-20">
    <div class="col-md-12">
        <h3 class="c-grey-900 mB-20" style="text-align:center">Salaries of Month @string.Format("{0: MMMM yyyy}", DateTime.Now)</h3>
    </div>
    <button id="btnbonus" data-toggle="modal" data-target="#Modal" class="btn btn-primary pointer">Bonus</button>
    <button type="submit" class="btn btn-primary Salary_Status" value="Step_3">Forward</button>
    <button type="submit" class="btn btn-success sal-rep">Salary Report</button>
    <h4 class="c-grey-900 mB-20">Employess salaries</h4>
    <div class="tableFixHead">
        <table id="salary-dat" class="table table-striped table-bordered " cellspacing="0" width="100%">
            <thead class="thead-dark ka">
                <tr>
                    <th>Sr.</th>
                    <th>Code</th>
                    <th>Name</th>
                    <th>Designation</th>
                    @*<th>Previous Basic Salary</th>*@
                    @*<th>COLA</th>*@
                    <th>Basic Salary</th>
                    <th>Stipend</th>
                    <th>Per Day Wage</th>
                    <th>Date Of Joining</th>
                    <th>No Of Days</th>
                    <th>Absentee</th>
                    <th>Leaves</th>
                    <th>Extra Days</th>
                    <th>Overtime</th>
                    <th>No Of Worked Days</th>
                    <th>Allownces/Arrear</th>
                    <th>Extra Days Wage</th>
                    <th>Bonus DESC.</th>
                    <th>Bonus</th>
                    <th>Absentee Ded.</th>
                    <th>Loan</th>
                    <th>Advance</th>
                    <th>Other Ded</th>
                    <th>Net Payable</th>
                    <th>FWD / REV</th>
                </tr>
            </thead>
            @{
                if (Model.Any())
                {
                    foreach (var g in Model.GroupBy(x => new { x.DepartmentId, x.DepartmentName }))
                    {
                        long? g_dep = (g.Key.DepartmentId is null) ? 0 : g.Key.DepartmentId;
                        int sr = 1;
                        <thead>
                            <tr>
                                <th colspan="22" style="font-size:21px;text-align:center"> @g.Key.DepartmentName</th>
                            </tr>
                            <tr>
                                <th>Sr.</th>
                                <th>Code</th>
                                <th>Name</th>
                                <th>Designation</th>
                                @*<th>Previous Basic Salary</th>*@
                                @*<th>COLA</th>*@
                                <th>Basic Salary</th>
                                <th>Stipend</th>
                                <th>Per Day Wage</th>
                                <th>Date Of Joining</th>
                                <th>No Of Days</th>
                                <th>Absentee</th>
                                <th>Leaves</th>
                                <th>Extra Days</th>
                                <th>Overtime</th>
                                <th>No Of Worked Days</th>
                                <th>Allownces/Arrear</th>
                                <th>Extra Days Wage</th>
                                <th>Bonus DESC.</th>
                                <th>Bonus</th>
                                <th>Absentee Ded.</th>
                                <th>Loan</th>
                                <th>Advance</th>
                                <th>Other Ded</th>
                                <th>Net Payable</th>
                                <th>FWD / REV</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in g)
                            {
                                <tr class="" id="@item.Id">
                                    <td class="">@sr</td>
                                    <td>@item.Employee_code</td>
                                    <td>@item.Employee_Name</td>
                                    <td>@item.Designation_name</td>
                                    @*<td>@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(item.Previous_Basic_Salary)))</td>*@
                                    @*<td>@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(item.COLA_Amount)))</td>*@
                                    <td class="basic_salary @g_dep-basicSalary @g_dep-basic_salary" id="@g_dep">@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(item.Basic_salary)))</td>
                                    <td class="Stipend @g_dep-Stipend @g_dep-Stipend" id="@g_dep">@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(item.Stipend)))</td>
                                    <td class="">@( Math.Round(Convert.ToDecimal(item.Basic_salary / 30)) )</td>
                                    <td style="font-weight:bold">@string.Format("{0: dd-MMM-yyyy}", item.Emp_Date_Of_Joining)</td>
                                    <td>@item.No_Of_Days</td>
                                    <td>@item.Absentee</td>
                                    <td>@item.Salary_Leaves</td>
                                    <td>@item.Extra_Working_Days</td>
                                    <td>@string.Format("{0:n0}", item.Overtime)</td>
                                    <td>@(item.No_Of_Days - item.Absentee - item.Salary_Leaves + item.Extra_Working_Days)</td>
                                    <td class="t_allownce all_calc ti-pencil alnc-add-fld @g_dep-8" data-toggle="modal" data-target="#Modal" id="@g_dep"> @String.Format("{0:n0}", Math.Round(Convert.ToDecimal(item.Allownces))) </td>
                                    <td class="extra_work @g_dep-Ewd" id="@g_dep"> @String.Format("{0:n0}", Math.Round(Convert.ToDecimal(item.Basic_salary / 30 * item.Extra_Working_Days))) </td>
                                    <td>@item.Bonus_Description</td>
                                    <td class="bonus @g_dep-bon" id="@g_dep">@string.Format("{0:n0}", Math.Round(Convert.ToDecimal(item.Bonus)))</td>
                                    <td class="absn-cal @g_dep" id="@g_dep"><label>@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(item.Ded_Absentee)))</label></td>
                                    <td><span>@String.Format("{0:n0}", Math.Round(Convert.ToDouble(item.Ded_Loan)))</span></td>
                                    <td><span>@String.Format("{0:n0}", Math.Round(Convert.ToDouble(item.Ded_Advance)))</span></td>
                                    <td data-toggle="modal" data-target="#Modal" class="@g_dep-45 ti-pencil Salary_details fin-dedc" id="@item.DepartmentName"> @String.Format("{0:n0}", Math.Round(Convert.ToDouble(item.Ded_Other))) </td>
                                    <td class="GrndTot @g_dep-2" id="@item.Id" style="font:bold">@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(item.Grand_total)))</td>
                                    <td>
                                        <ul style="list-style:none;margin-left:0px;">
                                            <li class="dropdown">
                                                <a href="" class="dropdown-toggle no-after peers " data-toggle="dropdown">
                                                    <i class="ti-more-alt  c-grey-900" style="transform:rotate(90deg);"></i>
                                                </a>
                                                <ul class="dropdown-menu">
                                                    <li><a id="Step_3" class="pointer reverse_salary" data-id="@item.Id"><span>Forward</span></a></li>
                                                    <li role="separator" class="divider"></li>
                                                    <li><a id="Step_1" class="pointer reverse_salary" data-id="@item.Id"><span>Reverse</span></a></li>
                                                    <li><a class="pointer del-sal" data-id="@item.Id"><span>Delete</span></a></li>
                                                    <li><a class="pointer up-sal" data-id="@item.Id"><span>Update</span></a></li>
                                                    @*<li><a class="pointer" id="btnbonusIndividual" data-toggle="modal" data-target="#Modal" data-id="@item.Id"><span>COLA</span></a></li>*@
                                                </ul>
                                            </li>
                                        </ul>
                                    </td>
                                </tr>
                                sr++;

                            }
                            <tr>
                                <td style="font-size:20px" colspan="4">Gross Total</td>
                                @*<td>@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(g.Select(x => x.Previous_Basic_Salary).Sum())))</td>*@
                                @*<td>@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(g.Select(x => x.COLA_Amount).Sum())))</td>*@
                                <td class="@g_dep-basic_salarygr">@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(g.Select(x => x.Basic_salary).Sum())))</td>
                                <td class="@g_dep-Stipendgr">@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(g.Select(x => x.Stipend).Sum())))</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td id="totl_allownce" class="@g_dep-9">@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(g.Select(x => x.Allownces).Sum()))) </td>
                                <td class="@g_dep-1Ewd">@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(g.Select(x => x.Basic_salary / 30 * x.Extra_Working_Days).Sum())))</td>
                                <td></td>
                                <td class="@g_dep-1depBo">@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(g.Select(x => x.Bonus).Sum())))</td>
                                <td class=" @g_dep-1">@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(g.Select(x => x.Ded_Absentee).Sum()@*- (g.Select(x => x.Basic_salary / 30 * x.Salary_Leaves).Sum()*@))) </td>
                                <td>@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(g.Select(x => x.Ded_Loan).Sum()))) </td>
                                <td>@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(g.Select(x => x.Ded_Advance).Sum()))) </td>
                                <td class=" @g_dep-450">@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(g.Select(x => x.Ded_Other).Sum())))</td>
                                <td class=" @g_dep-22">@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(g.Select(x => x.Grand_total).Sum())))</td>
                                <td></td>
                            </tr>
                        </tbody>
                    }
                    <tfoot>
                        <tr>
                            <th style="font-size:20px" colspan="4">Total</th>
                            @*<th>@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(Model.Sum(x => x.Previous_Basic_Salary))))</th>*@
                            @*<th>@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(Model.Sum(x => x.COLA_Amount))))</th>*@
                            <th class="total_basic_salary">@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(Model.Sum(x => x.Basic_salary))))</th>
                            <th class="total_Stipend">@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(Model.Sum(x => x.Stipend))))</th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th class="total_allownces">@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(Model.Sum(x => x.Allownces))))</th>
                            <th class="total_extra_wage">@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(Model.Sum(x => x.Basic_salary / 30 * x.Extra_Working_Days))))</th>
                            <th></th>
                            <th>@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(Model.Sum(x => x.Bonus))))</th>
                            <th class="footer_ded_absen">@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(Model.Sum(x => x.Ded_Absentee)@*- Model.Sum(x => x.Basic_salary / 30 * x.Salary_Leaves)*@)))</th>
                            <th>@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(Model.Sum(x => x.Ded_Loan))))</th>
                            <th>@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(Model.Sum(x => x.Ded_Advance))))</th>
                            <th class="footer_othr_ded">@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(Model.Sum(x => x.Ded_Other))))</th>
                            <th class="NetPaysum">@String.Format("{0:n0}", Math.Round(Convert.ToDecimal(Model.Sum(x => x.Grand_total))))</th>
                            <th></th>
                        </tr>
                    </tfoot>
                }
                else
                {
                    <tfoot>
                        <tr>
                            <td colspan="22">No Record Exists</td>
                        </tr>
                    </tfoot>
                }
            }
        </table>
    </div>
</div>




<script>
    $(document).ready(function () {
        $('.alnc-add-fld').unbind().click(function () {
            salary_id = $(this).closest('tr').attr("id");
            Grp_Name = $(this).attr('id');
            Groupid = $(this).closest('tr').find('.all_calc').attr('id');
            EmptyModel();
            $('#ModalLabel').text("Add Allowances");
            $('#modalbody').load('/Salaries/AddSalaryAllowance/', { Id: salary_id });
        });

        $('.bns-btn').unbind().click(function () {
            EmptyModel();
            $('#ModalLabel').text("Bonuses");
            $('#modalbody').load('/Salaries/Bonus/');
        });
    });
</script>



@*(Basic_salary/30*(No_Of_Days-Absentee))+Allownces+Bonus+((Basic_salary/30)*Extra_Working_Days)+Extra_Fuel_Charges+Overtime-Ded_Loan-Ded_Advance-Ded_Tax-Ded_Other*@
@{
    Layout = "~/Views/Shared/_StaffLayout.cshtml";
}
<script>
    var banklist = @Html.Raw(Json.Encode(ViewBag.Bank));
</script>
<div class="row gap-20 pos-r">
    <div class="col-md-12">
        <div class="bgc-white p-20 bd">
            <h6 class="c-grey-900">Biding Plot Registeration</h6>
            <div class="mT-30">
                <div class="form-row row">
                    <div class="col-md-12">
                        <div class="form-row">
                            <div class="form-group col-md-2">
                                <label>Dealership</label>
                                <select class="form-control plt-reg-lst" id="deal-id">
                                    <option>Select Dealership</option>
                                    <option value="32">Al Nafay Estate</option>
                                    <option value="34">Al Raheem Estate</option>
                                    <option value="41">Arshman Estate</option>
                                    <option value="59">Khan Estate</option>
                                    <option value="67">Master Mind Real Estate</option>
                                    <option value="74">Noorani Estate</option>
                                    <option value="81">Rehman Estate</option>
                                </select>
                            </div>
                            <div class="form-group col-md-3">
                                <label>-</label>
                                <input type="button" class="btn btn-info" id="ser-bid-plot" value="Search" />
                            </div>
                        </div>
                        <hr />
                        <div class="form-row">
                            <table class="table table-striped table-bordered" id="plt-lst">
                                <thead>
                                    <tr>
                                        <th>Sr</th>
                                        <th>Plot No.</th>
                                        <th>Sector</th>
                                        <th>Block</th>
                                        <th>Size</th>
                                        <th>Location</th>
                                        <th>Rate</th>
                                        <th>Price</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                                <tfoot>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <hr />
            @using (Html.BeginForm("BidingRegisterPlots", "Plots", FormMethod.Post, new { @id = "re-bid-plot", @class = "", role = "form", autocomplete = "off" }))
            {

                <div class="mT-30 close-info">
                    <h6 class="c-grey-900">Owner Information</h6>
                    <div class="form-row row ">
                        <div class="col-md-12">
                            <div class="form-row">
                                <div class="form-group col-md-3">
                                    <label>Name</label>
                                    <input type="text" class="form-control" name="Name" required>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>Father's/Husband's Name</label>
                                    <input type="text" class="form-control" name="Father_Husband" required>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>CNIC / NICOP</label>
                                    <input type="text" class="form-control" name="CNIC_NICOP" placeholder="12345-1234567-1   or   123456-123456-1" required>
                                </div>
                                <div class="form-group col-md-2">
                                    <label>Date Of Birth</label>
                                    <input type="text" class="form-control" data-provide="datepicker" placeholder="mm/dd/yyyy - mm/dd/yyyy" name="Date_Of_Birth" required>
                                </div>
                                <div class="form-group col-md-6">
                                    <label>Postal Address</label>
                                    <input type="text" class="form-control" name="Postal_Address" placeholder="1234 Main St" required>
                                </div>
                                <div class="form-group col-md-6">
                                    <label>Residential Address</label>
                                    <input type="text" class="form-control" name="Residential_Address" placeholder="Apartment, Plot, or floor" required>
                                </div>
                                <div class="form-group col-md-2">
                                    <label>City</label>
                                    @Html.DropDownList("City", null, "Choose..", new { @class = "form-control", required = "" })
                                </div>
                                <div class="form-group col-md-3">
                                    <label>Occupation</label>
                                    <input type="text" class="form-control" name="Occupation">
                                </div>
                                <div class="form-group col-md-2">
                                    <label>Nationality</label>
                                    <input type="text" class="form-control" name="Nationality">
                                </div>
                                <div class="form-group col-md-3">
                                    <label>Email</label>
                                    <input type="text" class="form-control" name="Email">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-3">
                                    <label>Phone Office</label>
                                    <input type="text" class="form-control" name="Phone_Office">
                                </div>
                                <div class="form-group col-md-3">
                                    <label>Residential</label>
                                    <input type="text" class="form-control" name="Residential">
                                </div>

                                <div class="form-group col-md-3">
                                    <label>Mobile 1</label>
                                    <input type="text" class="form-control" placeholder="03121234567" name="Mobile_1" required>
                                </div>

                                <div class="form-group col-md-3">
                                    <label>Mobile 2</label>
                                    <input type="text" class="form-control" pattern="^0\d{10}" placeholder="03121234567" name="Mobile_2">
                                </div>
                            </div>
                        </div>
                    </div>
                    <h6 class="c-grey-900">Nominee</h6>
                    <div class="form-row">
                        <div class="form-group col-md-3">
                            <label>Name</label>
                            <input type="text" class="form-control" name="Nominee_Name">
                        </div>
                        <div class="form-group col-md-2">
                            <label>CNIC / NICOP</label>
                            <input type="text" class="form-control" placeholder="12345-1234567-1 or 123456-123456-1" name="Nominee_CNIC_NICOP">
                        </div>
                        <div class="form-group col-md-2">
                            <label>Relation</label>
                            <input class="form-control" name="Nominee_Relation" placeholder="">
                        </div>
                        <div class="form-group col-md-5">
                            <label>Address</label>
                            <input type="text" class="form-control" name="Nominee_Address" placeholder="1234 Main St">
                        </div>
                    </div>
                </div>
                <hr />
                <div class="form-row">

                    <div class="col-md-3">
                        <h6 class="c-grey-900">Advance: <span id="adv-pmt"></span></h6>
                        <input type="hidden" id="adv-pmt-hid" />
                    </div>
                    <div class="col-md-3">
                        <button type="button" id="add-pay-typ" class="btn btn-info"><i class="ti-plus"></i>&nbsp; Add Payment</button>
                    </div>
                    <div class="col-md-3">
                        <button type="submit" id="reg-plot" class="btn btn-primary">Register</button>
                    </div>
                </div>
                <div class="mT-30">
                    <div class="mT-30" id="pay-list">
                        <div class="form-row" id="pay-1">
                            <div class="form-group col-md-2">
                                <label>Cash / Bank</label>
                                <select class="form-control paytypesel" id="cah-chq-bak" required>
                                    <option value="Cash">Cash</option>
                                    <option value="BankDraft">Bank Draft</option>
                                    <option value="Cheque">Cheque</option>
                                    <option value="PayOrder">Pay Order</option>
                                    <option value="Online_Cash">Online - Cash</option>
                                    <option value="Online_Cheque">Online - Cheque</option>
                                    <option value="Online_Payorder">Online - PayOrder</option>
                                    <option value="Online_Bankdraft">Online - BankDraft</option>
                                </select>
                            </div>
                            <div class="form-group col-md-1">
                                <label>Amount</label>
                                <input class="form-control coma" placeholder="250,000" required>
                                <input type="hidden" id="Amount" class="amt" required>
                            </div>
                            <div class="form-group col-md-2 paymentotherinfo">
                                <label id="paytypelabel">-</label>
                                <input type="text" class="form-control" id="paymenttype" placeholder="" disabled required>
                            </div>
                            <div class="form-group col-md-2 paymentotherinfo">
                                <label>Date</label>
                                <input type="text" class="form-control" id="cbp-date" data-provide="datepicker" placeholder="mm/dd/yyyy" disabled required>
                            </div>
                            <div class="form-group col-md-2 paymentotherinfo">
                                <label>Bank</label>
                                <select class="form-control" id="bank" disabled>
                                    <option>Choose..</option>
                                </select>
                            </div>
                            <div class="form-group col-md-2 paymentotherinfo">
                                <label>Branch </label>
                                <input type="text" class="form-control" id="Branch" placeholder="Mall Rd" disabled required>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>
<style>
    .paymentotherinfo {
        display: none;
    }

    #inst-stat {
        height: 1245px;
        overflow-y: scroll;
    }
    table tr th, table tr td {
        padding: 5px !important;
        font-size: 12px;
    }
</style>

<script>
    $(function () {
        InitBanks(1);
    });
    $(document).on("click", "#ser-bid-plot", function (e) {
        e.preventDefault();
        var id = $("#deal-id").val();
        $.ajax({
            type: "POST",
            url: '/Plots/DealerPlots/',
            data: { Id: id },
            success: function (data) {
                $("#plt-lst tbody").empty();
                $("#plt-lst tfoot").empty();
                $(".plt-ids").remove();
                var total = 0;
                $(data).each(function (i) {
                    var a = i + 1;
                    var size = data[i].Size.split(' ');
                    var grandtotal = size[0] * data[i].Rate;
                    total = total + grandtotal;
                    $("#adv-pmt").text(ComaAmount(advance));
                    $("#adv-pmt-hid").val(advance);
                    var plotratecoma = (grandtotal == null) ? "" : grandtotal.toString();
                    plotratecoma = ComaAmount(plotratecoma);

                    $('#gran-cal').val(plotratecoma);
                    var html = '<tr><td>' + a + '</td><td>' + data[i].PlotNumber + '</td><td>' + data[i].Sector + '</td><td>' + data[i].Block + '</td><td>' + data[i].Size + '</td><td>' + data[i].Location + '</td><td>' + ComaAmount(data[i].Rate) + '</td><td>' + plotratecoma + '</td></tr>';
                    var hidhtml = '<input type="hidden" class="plt-ids" value="' + data[i].PlotId + '" />';
                    $("#re-bid-plot").append(hidhtml);
                    $("#plt-lst tbody").append(html);
                });
                var advance = (total * 25) / 100;
                $("#adv-pmt").text(ComaAmount(advance));
                $("#adv-pmt-hid").val(advance);
                var comatotal = ComaAmount(total);
                var html1 = '<tr><th colspan="6"></th><th>Total Price</th><th id="ttl-pric">' + comatotal + '</th></tr>';
                $("#plt-lst tfoot").append(html1);
            }
            , error: function (xmlhttprequest, textstatus, message) {
                if (textstatus === "timeout") {
                    alert("got timeout");
                } else {
                    alert(textstatus);
                }
            }
        });
    });

</script>